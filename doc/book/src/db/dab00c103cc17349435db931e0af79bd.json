[{"Start":{"CodeBlock":{"Fenced":"rust"}}},{"Text":"use rhdl::prelude::*;\n\n#[derive(Copy, PartialEq, Clone)]\npub enum OpCode {\n    Nop,\n    Add(b8, b8),\n    Sub(b8, b8),\n    Not(b8),\n}\n\nimpl Digital for OpCode {\n    const BITS: usize = 18;\n    fn static_kind() -> Kind {\n        let nop_variant = Kind::make_variant(\"Nop\", <() as Digital>::static_kind(), 0);\n        let add_variant = Kind::make_variant(\"Add\", <(b8, b8) as Digital>::static_kind(), 1);\n        let sub_variant = Kind::make_variant(\"Sub\", <(b8, b8) as Digital>::static_kind(), 2);\n        let not_variant = Kind::make_variant(\"Not\", <b8 as Digital>::static_kind(), 3);\n        let alignment = rhdl::core::DiscriminantAlignment::Msb;\n        let ty = rhdl::core::DiscriminantType::Unsigned;\n        let layout = Kind::make_discriminant_layout(2, alignment, ty);\n        Kind::make_enum(\n            \"OpCode\",\n            [nop_variant, add_variant, sub_variant, not_variant].into(),\n            layout,\n        )\n    }\n    fn bin(self) -> Box<[BitX]> {\n        let mut bits = Vec::with_capacity(Self::BITS);\n        match self {\n            OpCode::Nop => {\n                bits.extend((()).bin());\n                bits.extend(b16(0).bin());\n                bits.extend(b2(0b00).bin());\n            }\n            OpCode::Add(a, b) => {\n                bits.extend((a, b).bin());\n                bits.extend(b2(0b01).bin());\n            }\n            OpCode::Sub(a, b) => {\n                bits.extend((a, b).bin());\n                bits.extend(b2(0b10).bin());\n            }\n            OpCode::Not(a) => {\n                bits.extend(a.bin());\n                bits.extend(b8(0).bin());\n                bits.extend(b2(0b11).bin());\n            }\n        }\n        bits.into_boxed_slice()\n    }\n    fn dont_care() -> Self {\n        Self::Nop\n    }\n}"},{"End":"CodeBlock"}]