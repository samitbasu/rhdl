// ANCHOR: enum
use rhdl::prelude::*;

#[cfg(feature = "no-default-impl")]
//                                 ðŸ‘‡ - New!
#[derive(Copy, PartialEq, Clone, Digital)]
pub enum OpCode {
    Nop,
    Add(b8, b8),
    Sub(b8, b8),
    Not(b8),
}

// Delete the rest of the impl Digital; it's autogenerated now

// ANCHOR_END: enum

#[cfg(not(feature = "no-default-impl"))]
// ANCHOR: enum-fixed
//                                 ðŸ‘‡ - New!
#[derive(Copy, PartialEq, Clone, Digital, Default)]
pub enum OpCode {
    // ðŸ‘‡ - New! Need this too
    #[default]
    Nop,
    Add(b8, b8),
    Sub(b8, b8),
    Not(b8),
}
// ANCHOR_END: enum-fixed

#[test]
// ANCHOR: main
fn test_opcode_derived_layout() {
    let svg = OpCode::static_kind().svg("OpCode (Autoderive)");
    if !std::path::Path::new("opcode_derived.svg").exists() {
        std::fs::write("opcode_derived.svg", svg.to_string()).unwrap();
    }
}
// ANCHOR_END: main
