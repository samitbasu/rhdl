[{"Start":{"CodeBlock":{"Fenced":"rust"}}},{"Text":"use rhdl::prelude::*;\n\n#[derive(Copy, Clone, PartialEq, Digital, Default)]\npub enum State {\n    #[default]\n    Idle,\n    Running,\n    Paused,\n    Stopped,\n    Broken,\n}\n\n#[derive(Copy, Clone, PartialEq, Digital, Default)]\npub enum Event {\n    #[default]\n    Start,\n    Stop,\n}\n\n#[kernel]\nfn fsm(state: State, event: Event) -> State {\n    trace(\"state\", &state);\n    trace(\"event\", &event);\n    let next_state = match (state, event) {\n        (State::Idle, Event::Start) => State::Running,\n        (State::Running, Event::Stop) => State::Paused,\n        (State::Paused, Event::Start) => State::Running,\n        (State::Paused, Event::Stop) => State::Stopped,\n        (State::Stopped, Event::Stop) => State::Idle,\n        _ => State::Broken,\n    };\n    trace(\"next_state\", &next_state);\n    next_state\n}\n\n#[test]\nfn test_fsm() {\n    let events = [\n        Event::Start,\n        Event::Stop,\n        Event::Start,\n        Event::Stop,\n        Event::Stop,\n        Event::Stop,\n        Event::Stop,\n    ];\n    let mut state = State::Idle;\n    let guard = trace_init_db();\n    for (ndx, event) in events.iter().enumerate() {\n        trace_time((ndx * 100) as u64);\n        state = fsm(state, *event);\n    }\n    let options = SvgOptions::default();\n    let svg = guard.take().dump_svg(0..=700, &options);\n    std::fs::write(\"tracing_demo_fsm.svg\", svg.to_string()).unwrap();\n}"},{"End":"CodeBlock"}]