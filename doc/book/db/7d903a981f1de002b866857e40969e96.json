[{"Start":{"CodeBlock":{"Fenced":"rust"}}},{"Text":"use rhdl::prelude::*;\n\n#[derive(Copy, Clone, PartialEq, Digital, Default)]\npub enum OpCode {\n    Sum(b8, b8),\n    Diff(b8, b8),\n    And(b8, b8),\n    Or(b8, b8),\n    Xor(b8, b8),\n    #[default]\n    Noop,\n}\n\n#[kernel]\nfn alu(op: OpCode) -> Option<b8> {\n    trace(\"op\", &op);\n    let output = match op {\n        OpCode::Sum(a, b) => Some(a + b),\n        OpCode::Diff(a, b) => Some(a - b),\n        OpCode::And(a, b) => Some(a & b),\n        OpCode::Or(a, b) => Some(a | b),\n        OpCode::Xor(a, b) => Some(a ^ b),\n        OpCode::Noop => None,\n    };\n    trace(\"output\", &output);\n    output\n}\n\n#[test]\nfn test_alu() {\n    let ops = [\n        OpCode::Sum(b8::from(10), b8::from(5)),\n        OpCode::Diff(b8::from(20), b8::from(8)),\n        OpCode::And(b8::from(0b11001100), b8::from(0b01101111)),\n        OpCode::Or(b8::from(0b11001111), b8::from(0b10111010)),\n        OpCode::Xor(b8::from(0b11111100), b8::from(0b10101110)),\n        OpCode::Noop,\n    ];\n    let guard = trace_init_db();\n    for (ndx, op) in ops.iter().enumerate() {\n        trace_time((ndx * 100) as u64);\n        let _ = alu(*op);\n    }\n    let options = SvgOptions::default();\n    let svg = guard.take().dump_svg(0..=600, &options);\n    std::fs::write(\"tracing_demo_alu.svg\", svg.to_string()).unwrap();\n}"},{"End":"CodeBlock"}]